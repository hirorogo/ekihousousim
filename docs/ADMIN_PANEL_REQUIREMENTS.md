# 管理者パネル 要件定義書

## 1. 概要

### 1.1 目的
資料共有システムの管理者が、アップロードされた資料やシステムの状態を効率的に管理・監視できるダッシュボードを提供する。

### 1.2 対象ユーザー
- システム管理者

### 1.3 背景
現在のシステムでは、以下の課題があります：
- 資料の編集・削除が困難
- システム全体の統計情報が見えない
- 不適切なコンテンツの監視・削除ができない
- ユーザーの行動履歴が追跡できない

## 2. システム要件

### 2.1 認証・認可

#### 2.1.1 認証方式
**Phase 1（初期実装）：**
- 簡易パスワード認証
- ローカルストレージでのセッション管理
- 管理者アカウントは1つのみ
- 検索窓にadminと入れることで入口が出現
- パスワードは114514
### 2.2 画面構成

#### 2.2.1 レイアウト
```
+------------------+------------------------+
| サイドバー       |  メインコンテンツ      |
| - ダッシュボード |                        |
| - 資料管理       |                        |
| - 統計情報       |                        |
| - 設定           |                        |
| - ログアウト     |                        |
+------------------+------------------------+
```

#### 2.2.2 ページ構成
1. **ダッシュボード** (`/admin`)
2. **資料管理** (`/admin/materials`)
3. **統計情報** (`/admin/statistics`)
4. **設定** (`/admin/settings`)
5. **ログイン** (`/admin/login`)

## 3. 機能要件

### 3.1 ダッシュボード

#### 3.1.1 概要統計
以下の情報をカード形式で表示：

- **総資料数**
  - 数値表示
  - 前日比の増減表示（オプション）

- **総閲覧数**
  - 全資料の閲覧数合計
  - 直近7日間の推移グラフ

- **総ダウンロード数**
  - 全資料のダウンロード数合計
  - 直近7日間の推移グラフ

- **アクティブユーザー数**（Phase 2）
  - 過去24時間のユニークユーザー数

#### 3.1.2 科目別統計
円グラフまたは棒グラフで表示：
```
数学: 15件
英語: 10件
物理: 8件
その他: 5件
```

#### 3.1.3 最近の活動
- 最新10件のアップロード資料
- タイトル、アップロード者、日時、IPアドレスを表示
- クリックで詳細表示

#### 3.1.4 アラート通知（Phase 2）
- 同一IPから短時間に複数アップロード
- 大容量ファイルのアップロード
- 不審なアクティビティの検知

### 3.2 資料管理

#### 3.2.1 資料一覧表示

**表示項目：**
| ID | タイトル | 科目 | アップロード者 | IPアドレス | ファイルサイズ | 日時 | 閲覧数 | DL数 | 操作 |
|----|---------|------|---------------|-----------|--------------|------|--------|------|------|

**機能：**
- ページネーション（20件/ページ）
- ソート機能
  - 日時（昇順・降順）
  - 閲覧数（多い順・少ない順）
  - ダウンロード数（多い順・少ない順）
  - ファイルサイズ（大きい順・小さい順）

#### 3.2.2 検索・フィルター

**検索：**
- タイトルでの全文検索
- 説明文での検索
- アップロード者名での検索

**フィルター：**
- 科目で絞り込み
- 日付範囲で絞り込み
- IPアドレスで絞り込み
- ファイル形式で絞り込み（PDF、画像等）

#### 3.2.3 資料編集機能

**編集可能な項目：**
```javascript
{
  title: string,           // タイトル
  subject: string,         // 科目
  description: string,     // 説明文
  uploader: string,        // アップロード者名
  tags: string[]          // タグ
}
```

**編集方法：**
- モーダルダイアログで編集フォーム表示
- インライン編集（Phase 2）
- 変更履歴の記録（Phase 2）

**バリデーション：**
- タイトル：必須、最大100文字
- 科目：選択式（既存の科目リスト）
- 説明文：任意、最大500文字

#### 3.2.4 資料削除機能

**削除方法：**
1. 個別削除
   - 削除ボタンクリック
   - 確認ダイアログ表示
   - ファイルとデータの両方を削除

2. 一括削除（Phase 2）
   - チェックボックスで複数選択
   - 一括削除ボタン
   - 確認ダイアログで削除対象を一覧表示

**削除処理：**
```javascript
// 削除時の処理
1. materials.jsonから該当データを削除
2. server/uploadsから該当ファイルを削除
3. 削除ログを記録（Phase 2）
4. 成功メッセージを表示
```

**削除前の確認：**
```
本当にこの資料を削除しますか？

タイトル: 〇〇〇
ファイル名: 〇〇〇.pdf
この操作は取り消せません。

[キャンセル] [削除する]
```

#### 3.2.5 一括操作（Phase 2）
- 一括編集（科目の一括変更等）
- 一括エクスポート
- 一括タグ付け

### 3.3 統計情報

#### 3.3.1 アクセス統計グラフ

**期間選択：**
- 過去7日間
- 過去30日間
- 過去3ヶ月
- カスタム期間

**グラフ種類：**
1. **閲覧数の推移**
   - 折れ線グラフ
   - 日別の推移

2. **ダウンロード数の推移**
   - 折れ線グラフ
   - 日別の推移

3. **科目別分布**
   - 円グラフまたは棒グラフ
   - パーセンテージ表示

4. **ファイル形式別分布**
   - 円グラフ
   - PDF、画像、テキストの割合

#### 3.3.2 人気資料ランキング

**表示項目：**
1. 閲覧数ランキング（TOP 10）
2. ダウンロード数ランキング（TOP 10）
3. 最新アップロードランキング（TOP 10）

**表示形式：**
```
順位 | タイトル | 科目 | 閲覧数/DL数 | アップロード日
-----|---------|------|-------------|---------------
1    | 〇〇〇  | 数学 | 150回       | 2025-11-01
2    | △△△  | 英語 | 120回       | 2025-11-02
...
```

#### 3.3.3 IPアドレス別統計（Phase 2）

**表示項目：**
- アップロード回数の多いIP（TOP 10）
- 不審なアクティビティを示すIP
- ブロックリスト

### 3.4 設定

#### 3.4.1 システム設定

**アップロード設定：**
- 最大ファイルサイズ（デフォルト：50MB）
- 許可するファイル形式
- アップロード承認フローの有効/無効（Phase 2）

**表示設定：**
- ページあたりの表示件数
- デフォルトのソート順
- テーマ設定（ライト/ダーク）（Phase 2）

**セキュリティ設定：**
- セッションタイムアウト時間
- パスワードポリシー
- IPブロックリスト（Phase 2）

#### 3.4.2 管理者アカウント設定

**変更可能な項目：**
- パスワード変更
- 表示名変更
- メールアドレス設定（Phase 2）

#### 3.4.3 バックアップ・エクスポート（Phase 2）

**機能：**
- materials.jsonのバックアップダウンロード
- CSVエクスポート
- 定期バックアップ設定

## 4. 技術仕様

### 4.1 ファイル構成

```
src/
├── pages/
│   ├── AdminLogin.jsx              # 管理者ログインページ
│   ├── AdminPanel.jsx              # ダッシュボード
│   ├── AdminMaterials.jsx          # 資料管理ページ
│   ├── AdminStatistics.jsx         # 統計情報ページ
│   └── AdminSettings.jsx           # 設定ページ
├── components/
│   ├── admin/
│   │   ├── AdminLayout.jsx         # 管理者画面レイアウト
│   │   ├── AdminSidebar.jsx        # サイドバーナビゲーション
│   │   ├── StatsCard.jsx           # 統計カード
│   │   ├── MaterialTable.jsx       # 資料一覧テーブル
│   │   ├── EditMaterialModal.jsx   # 編集モーダル
│   │   ├── DeleteConfirmDialog.jsx # 削除確認ダイアログ
│   │   └── ChartComponent.jsx      # グラフ表示
│   └── ...
├── css/
│   ├── AdminLogin.module.css
│   ├── AdminPanel.module.css
│   ├── AdminMaterials.module.css
│   ├── AdminStatistics.module.css
│   ├── AdminSettings.module.css
│   └── admin/
│       ├── AdminLayout.module.css
│       ├── AdminSidebar.module.css
│       ├── StatsCard.module.css
│       └── ...

```

## 5. セキュリティ要件



### 6.1 レスポンス時間
- ページ読み込み：2秒以内
- API応答：500ms以内
- グラフ描画：1秒以内

### 6.2 データ処理
- 大量データ対応（1000件以上の資料）
- ページネーションによる負荷軽減
- 遅延読み込み（Lazy Loading）

## 7. 実装フェーズ

### Phase 1（基本機能）- 優先度：高
**実装期間：** 2週間

1. 管理者認証システム
   - ログイン/ログアウト
   - セッション管理
   - admin.jsonの作成

2. ダッシュボード
   - 基本統計表示
   - 科目別分布
   - 最近のアップロード一覧

3. 資料管理
   - 一覧表示（IPアドレス含む）
   - 検索・フィルター
   - 編集機能
   - 削除機能（個別のみ）

4. レイアウト
   - サイドバーナビゲーション
   - 管理者画面のレイアウト

### Phase 2（拡張機能）- 優先度：中
**実装期間：** 2週間

1. 統計情報ページ
   - グラフ表示（Chart.js使用）
   - 期間指定
   - 人気資料ランキング

2. 一括操作
   - 一括削除
   - 一括編集

3. 設定ページ
   - システム設定
   - アカウント設定

4. アラート機能
   - 不審なアクティビティ検知
   - 通知表示

### Phase 3（高度な機能）- 優先度：低
**実装期間：** 2週間

1. IPアドレス分析
   - IP別統計
   - ブロックリスト機能

2. バックアップ・エクスポート
   - データバックアップ
   - CSVエクスポート

3. 承認フロー
   - アップロード承認
   - 承認待ちキュー

4. 詳細なログ機能
   - 操作履歴
   - 監査ログ

## 8. テスト計画

### 8.1 単体テスト
- 各コンポーネントの動作確認
- API関数のテスト
- 認証ロジックのテスト

### 8.2 結合テスト
- ページ遷移の確認
- API連携の確認
- データ整合性の確認

### 8.3 セキュリティテスト
- 認証回避の試行
- XSS/SQLインジェクションテスト
- 権限チェックの確認

### 8.4 ユーザビリティテスト
- 実際の管理者による操作テスト
- 使いやすさの評価
- フィードバック収集

## 9. リスクと対策

### 9.1 セキュリティリスク
**リスク：** 管理者アカウントの漏洩
**対策：**
- 強力なパスワードポリシー
- 2段階認証の検討（Phase 3）
- ログイン試行回数の制限

### 9.2 パフォーマンスリスク
**リスク：** 大量データでの動作遅延
**対策：**
- ページネーション
- インデックスの最適化
- キャッシュの活用

### 9.3 データ損失リスク
**リスク：** 誤削除や障害によるデータ損失
**対策：**
- 削除前の確認ダイアログ
- 定期バックアップ
- ソフトデリート機能（Phase 3）

## 10. 成功基準

以下の基準を満たした場合、本機能は成功とみなします：

1. **機能要件**
   - Phase 1の全機能が正常動作
   - 資料の編集・削除が問題なく行える
   - 統計情報が正確に表示される

2. **パフォーマンス**
   - ページ読み込み2秒以内
   - 1000件以上の資料でも快適に動作

3. **セキュリティ**
   - 脆弱性診断でクリティカルな問題なし
   - 認証が適切に機能

4. **ユーザビリティ**
   - 管理者が迷わず操作できる
   - 主要操作が3クリック以内で完了

## 11. 今後の拡張案

- Firebase連携による高度な認証
- リアルタイム更新（WebSocket）
- モバイルアプリ版管理者パネル
- AI による不適切コンテンツ検出
- 多言語対応
- ダークモード対応

---
あとapiサーバーがどのように動いていてデータベースがどうなっているのか見れるようにしたい

**作成日：** 2025年11月9日  
**最終更新：** 2025年11月9日  
**ステータス：** 承認待ち  
**優先度：** 高

