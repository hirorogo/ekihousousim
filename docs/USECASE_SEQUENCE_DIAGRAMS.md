# ユースケース図・シーケンス図

## 1. ユースケース図

### 1.1 メインユースケース図

```
┌─────────────────────────────────────────────────────────────────┐
│                   テスト過去問・プリント共有サイト               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────┐                  ┌──────────────────┐         │
│  │   一般生徒   │                  │   高校教師       │         │
│  └──────┬───────┘                  └────────┬─────────┘         │
│         │                                   │                    │
│         │                                   │                    │
│      ┌──┴──────────────────────────────────┴──┐                 │
│      │                                        │                 │
│      │  ┌──────────────────────────┐          │                 │
│      │  │  サイトアクセス          │          │                 │
│      │  │  (認証)                  │          │                 │
│      │  │                          │          │                 │
│      │  │  ├─パスワード入力        │          │                 │
│      │  │  └─ログイン実行          │          │                 │
│      │  └──────────────────────────┘          │                 │
│      │           △                           │                 │
│      │           │ 認証後                    │                 │
│      │           │                           │                 │
│      │     ┌─────┴─────────────┬──────────────┴─────┐           │
│      │     │                   │                   │           │
│      │ ┌───▼──────────┐  ┌────▼─────────┐  ┌──────▼───┐      │
│      │ │資料検索      │  │資料アップロード│  │プロフィール│      │
│      │ │              │  │               │  │管理      │      │
│      │ │├─一覧表示    │  │├─タイトル入力 │  │├─情報表示│      │
│      │ │├─キーワード検索 │├─科目選択  │  │├─情報編集│      │
│      │ │├─科目フィルター│├─説明入力  │  │├─ログアウト│      │
│      │ │├─詳細表示    │  │├─ファイル選択 │  │└────────│      │
│      │ │└─コメント確認│  │├─バリデーション │            │      │
│      │ │              │  │├─確認表示  │             │      │
│      │ │              │  │└─アップロード完了 │             │      │
│      │ └──────────────┘  └────────────┘             │      │
│      │                                              │      │
│      │                                    ┌─────────┴──┐   │
│      │                                    │ (管理機能) │   │
│      │                                    │├─ユーザー管理│   │
│      │                                    │├─資料削除   │   │
│      │                                    │└─レポート表示│   │
│      │                                    └────────────┘   │
│      │                                                     │
│      └─────────────────────────────────────────────────────┘
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 詳細ユースケース分析

#### 1.2.1 認証ユースケース

```
ユースケース: サイトアクセス（認証）
─────────────────────────────────

アクター: 生徒、教師

前提条件: なし

基本フロー:
1. ユーザーがサイト URL にアクセス
2. 認証状態をチェック
3. 未認証の場合、ログインページへリダイレクト
4. ユーザーが共通パスワード（'123'）を入力
5. 送信ボタンをクリック
6. パスワードを照合
7. 一致 → LocalStorage に認証状態を保存 → ホームページへリダイレクト
   一致しない → エラーメッセージ表示 → ステップ 4 に戻る

代替フロー:
- ユーザーが既にログインしている場合
  → LocalStorage に保存された認証状態を確認
  → 直接ホームページを表示

例外フロー:
- LocalStorage がサポートされていない環境
  → セッションストレージを使用
  → ユーザーへ警告メッセージ表示

使用技術:
- App.jsx: 認証ロジック
- Login.jsx: UI
- constants.js: SITE_ACCESS_PASSWORD = '123'

事後条件: 認証ユーザーとしてサイト内機能にアクセス可能
```

#### 1.2.2 資料検索ユースケース

```
ユースケース: 資料検索・フィルタリング
──────────────────────────────

アクター: 生徒、教師

前提条件: ユーザーが認証済みである

基本フロー:
1. ユーザーが「資料一覧」ページを開く
2. 全資料がグリッド表示される
3. ユーザーがキーワードを検索欄に入力
4. リアルタイムに検索結果が絞り込まれる
5. ユーザーが科目ドロップダウンから科目を選択
6. さらに絞り込まれる
7. ユーザーが資料カードをクリック
8. 資料詳細ページへ遷移
9. 詳細情報（評価、コメント）を確認

代替フロー:
- キーワード検索結果が空の場合
  → 「該当する資料がありません」メッセージ表示
  → フィルター条件をリセット提案

- 科目が複数選択できる場合（将来実装）
  → 複数科目の OR 条件で検索

使用技術:
- MaterialList.jsx: フィルターロジック
- SearchBar.jsx: UI
- MaterialCard.jsx: 資料表示
- constants.js: SUBJECTS

事後条件: ユーザーが必要な資料を見つけられる
```

#### 1.2.3 資料アップロードユースケース

```
ユースケース: 資料アップロード
──────────────────────

アクター: 生徒、教師

前提条件: ユーザーが認証済みである

基本フロー:
1. ユーザーが「アップロード」ページを開く
2. フォーム（タイトル、科目、説明、ファイル）が表示される
3. ユーザーがタイトルを入力（最大 100 字）
4. 科目をドロップダウンから選択
5. 説明文を入力（最大 500 字、任意）
6. ファイルを選択（PDF、画像のみ、最大 10MB）
7. ニックネームを入力（最大 30 字）
8. 「アップロード」ボタンをクリック
9. クライアント側バリデーション実施
   - 必須項目確認
   - ファイルサイズ確認
   - ファイル形式確認
10. バリデーション成功 → 成功ダイアログ表示
11. フォームをリセット
12. (将来) Firebase へアップロード → 資料一覧に表示

代替フロー:
- ファイルサイズが 10MB を超える場合
  → 警告メッセージ表示
  → ステップ 6 に戻る

- 不正なファイル形式の場合
  → エラーメッセージ表示
  → ステップ 6 に戻る

- ユーザーが「キャンセル」ボタンをクリック
  → フォーム内容を破棄
  → 前のページへ戻る

例外フロー:
- Firebase が応答しない場合
  → エラーメッセージ表示
  → リトライオプション提供

使用技術:
- MaterialUpload.jsx: フォーム & バリデーション
- constants.js: SUBJECTS
- utils/api.js: (将来) Firebase 呼び出し

事後条件: 資料が Firestore に保存され、一覧に表示される
```

#### 1.2.4 プロフィール管理ユースケース

```
ユースケース: プロフィール表示・編集
──────────────────────────────

アクター: 生徒、教師

前提条件: ユーザーが認証済みである

基本フロー:
1. ユーザーが「プロフィール」ページを開く
2. 現在のユーザー情報が表示される
   - ニックネーム
   - 自己紹介文
   - プロフィール画像
   - アップロード資料数
   - ダウンロード総数
3. ユーザーが「編集」ボタンをクリック
4. 編集モードに移行
5. ユーザーがニックネームを変更（最大 30 字）
6. 自己紹介文を変更（最大 200 字）
7. プロフィール画像をアップロード（将来実装）
8. 「保存」ボタンをクリック
9. LocalStorage に新しい情報を保存
10. 成功メッセージを表示
11. 編集モード終了 → 更新された情報を表示

代替フロー:
- ユーザーが「キャンセル」をクリック
  → 変更を破棄
  → 編集モード終了

- ユーザーが「ログアウト」をクリック
  → LocalStorage 認証状態を削除
  → ログインページへリダイレクト

使用技術:
- Profile.jsx: フォーム
- useLocalStorage カスタムフック

事後条件: ユーザー情報が更新される
```

## 2. シーケンス図

### 2.1 ログインシーケンス

```
生徒          UI              App.jsx         LocalStorage
│             │                │                  │
├─Site Load───>│                │                  │
│              │ Check Auth    │                  │
│              │────────────────>│ getSiteAuth()   │
│              │                 │──────────────────>│
│              │                 │<─── 'true' ────<│
│              │<────────────────│                  │
│ Password     │                 │                  │
│ Page         │                 │                  │
├─入力────────>│                 │                  │
│              │                 │                  │
├─Login Button ├───onSubmit───>│                  │
│              │                 │ Validate       │
│              │                 │ password       │
│              │                 │ '123' == '123'?│
│              │                 │ YES             │
│              │                 │ setSiteAuth()  │
│              │                 │──────────────────>│
│              │                 │  (siteAuth=true) │
│              │                 │<──────────────│
│ Redirect     │                 │                  │
│ Home         │ Success        │                  │
│<──────────────┼─────────────────│                  │
│              │                 │                  │
```

### 2.2 資料検索シーケンス

```
生徒          SearchBar        MaterialList.jsx    Constants
│             │                │                   │
├─Open────────>│ Show           │                   │
│ Materials    │<───────────────│                   │
│ List Page    │ Render Subjects                   │
│              │                │ Load SUBJECTS     │
│              │                │<──────────────────│
│              │                │ SUBJECTS[]        │
│              │                │─────────────────>│
│ Type         │                │                   │
│ keyword──────>│                │                   │
│              │ onChange       │                   │
│              │ handleSearch() │                   │
│              │──────────────────> Filter by      │
│              │                │  title/desc      │
│              │<───────────────│ filteredList     │
│              │ Display        │                   │
│ Filtered     │ Results        │                   │
│ Results<─────┤                │                   │
│              │                │                   │
│ Select       │                │                   │
│ Subject──────>│ onChange       │                   │
│              │────────────────────> Filter by    │
│              │                │ subject          │
│              │<───────────────│ filteredList     │
│              │ Display        │                   │
│ Refined      │                │                   │
│ Results<─────┤                │                   │
│              │                │                   │
│ Click Card───>│                │                   │
│              │ onClick        │                   │
│              │────────────────────> Get Material │
│              │                │ Detail           │
│ Navigate     │<───────────────│                   │
│ to Detail    │ Navigate       │                   │
│<──────────────┤                │                   │
│              │                │                   │
```

### 2.3 資料アップロードシーケンス

```
生徒          フォーム          MaterialUpload      バリデーション
│             │                │                   │
├─Open────────>│ Show Form      │                   │
│ Upload Page  │<───────────────│                   │
│              │                │                   │
├─Title────────>│                │                   │
│ Input        │ onChange       │                   │
│              │─state.title──>│                   │
│              │                │                   │
├─Subject──────>│                │                   │
│ Select       │ onChange       │                   │
│              │─state.subject─>│                   │
│              │                │                   │
├─Description──>│                │                   │
│ Input        │ onChange       │                   │
│              │─state.desc─────>│                   │
│              │                │                   │
├─File────────>│                │                   │
│ Select       │ onChange       │                   │
│              │─state.file─────>│                   │
│              │                │                   │
├─Nickname─────>│                │                   │
│ Input        │ onChange       │                   │
│              │─state.nickname→│                   │
│              │                │                   │
│ Upload───────>│ onClick        │                   │
│ Button       │────────────────────> Validate    │
│              │                │────────────────────>
│              │                │<─ Valid ─────────
│              │                │ Validation OK    │
│              │                │ (file, sizes, etc)
│ Success◄─────┼────────────────│ localStorage     │
│ Message      │ Success Alert  │<──────────────────
│              │                │ Save form data   │
│              │                │                  │
│ Form Reset◄──┤ Clear Form     │                  │
│              │<───────────────│                  │
│              │                │                  │
```

### 2.4 プロフィール更新シーケンス

```
生徒          Profile.jsx      LocalStorage       UI
│             │                │                  │
├─Open────────>│ Show Profile   │                  │
│ Profile Page │<───────────────│                  │
│              │ Load userProfile               │
│              │────────────────>│                  │
│              │<─── userObj ───│                  │
│ Current Info │<───────────────│                  │
│              │ Display        │                  │
│              │─────────────────────────────────>│
│              │                │                  │
│ Edit Button──>│ onClick        │                  │
│              │ toggleEditMode()                 │
│              │ isEditMode=true │                  │
│              │─────────────────────────────────>│
│ Edit Mode    │ Show Form      │                  │
│ Displayed◄───┤                │                  │
│              │                │                  │
│ Change       │                │                  │
│ Nickname─────>│ onChange       │                  │
│              │─state.nickname→│                  │
│              │                │                  │
│ Save────────>│ onClick        │                  │
│ Button       │ Save to LS     │                  │
│              │────────────────>│                  │
│              │                │ setItem()        │
│              │<─── Success ───│                  │
│ Updated────<─┤ Success message│                  │
│ Display      │─────────────────────────────────>│
│              │                │                  │
│ Logout───────>│ onClick        │                  │
│ Button       │ RemoveItem()   │                  │
│              │────────────────>│                  │
│              │                │ removeItem()     │
│              │<─── Success ───│                  │
│ Redirect─────┤ Redirect to    │                  │
│ to Login◄────┤ Login          │                  │
│              │─────────────────────────────────>│
```

## 3. 活動図（Activity Diagram）

### 3.1 全体フロー

```
START
  │
  ▼
┌─────────────────────────┐
│  サイトアクセス         │
└─────────┬───────────────┘
          │
          ▼
     ┌─────────────┐
     │認証状態確認 │
     └──┬──────┬───┘
        │      │
    YES │      │ NO
        │      │
        ▼      ▼
    ┌─────┐ ┌──────────┐
    │HOME │ │ LOGIN    │
    └──┬──┘ │ 画面表示 │
       │    │┌────────┐│
       │    ││パスワード
       │    ││入力待機││
       │    │└───┬────┘│
       │    │    ▼     │
       │    │  検証     │
       │    └──┬───┬───┘
       │       │   │
       │   YES │   │ NO
       │       │   │
       │       ▼   ▼
       │     ┌─┐ ┌──────────┐
       │     │✓│ │ エラー   │
       │     └─┘ │ 表示     │
       │     AUTH│ 再入力   │
       │       ┌─┘ │待機     │
       │       │   │┌──────┐│
       │       │   ││再試行││
       │       │   │└──────┘│
       │       │   └────┬───┘
       │       │        │ RETRY
       │       │        └────────┬─────────┐
       │       │                 │ START   │
       │       │                 ▼         │
       │       └─────────────────────────┘
       │
       ▼
┌─────────────────┐
│ メニュー表示    │
├──┬──────┬───┬───┤
│ ▼      ▼   ▼   ▼
│HOME 資料検索 UP PROFILE
│ │      │    │  │
│ ▼      ▼    ▼  ▼
│
├─▼─────────────────────────────────────┐
│ 資料検索フロー                        │
│ ├─検索入力                           │
│ ├─フィルター選択                      │
│ ├─結果表示                           │
│ └─詳細表示                           │
├─▼─────────────────────────────────────┐
│ アップロードフロー                   │
│ ├─フォーム入力                       │
│ ├─バリデーション                    │
│ ├─確認表示                          │
│ └─アップロード完了                  │
├─▼─────────────────────────────────────┐
│ プロフィールフロー                   │
│ ├─情報表示                          │
│ ├─編集開始                          │
│ ├─情報更新                          │
│ └─ログアウト                        │
│
▼
┌──────────────────┐
│ アプリケーション終了 │
│ ロードキャッシュ │
└──────────────────┘
```

### 3.2 バリデーションフロー

```
アップロードフォーム送信
  │
  ▼
┌──────────────────────┐
│必須項目チェック      │
│ - タイトル           │
│ - 科目               │
│ - ファイル           │
│ - ニックネーム       │
└──┬────────────────┬──┘
   │ OK             │ FAIL
   │                │
   ▼                ▼
┌──────────────────┐ ┌─────────────────┐
│ファイルサイズ    │ │エラー表示        │
│チェック          │ │ユーザーに通知   │
│ < 10MB?          │ │修正指示          │
└──┬────────────┬──┘ └────────┬────────┘
   │ YES        │ NO          │
   │            │             │
   ▼            │             │
┌──────────────────┐          │
│ファイル形式      │          │
│チェック          │          │
│.pdf/.jpg/.png?   │          │
└──┬────────────┬──┘          │
   │ YES        │ NO          │
   │            │             │
   ▼            ▼             │
┌──────────────────┐ ┌────────────┐
│全バリデーション │ │エラーアラート│
│成功              │ │ユーザーに通知│
│                  │ │修正待機      │
│成功画面表示      │ │             │
│フォームリセット  │ │再入力        │
│                  │ │             │
└──────────────────┘ └─────┬───────┘
         │                 │
         │ RETRY           │
         └────────────┬────┘
                      │
                      ▼
                   フォーム表示
```

## 4. 状態遷移図（State Transition Diagram）

### 4.1 ユーザー認証状態

```
┌────────┐
│未認証  │ ◄─────────┐
│状態    │           │
└─┬──────┘           │
  │                  │
  │ パスワード入力   │
  │ (onAuthenticated)│ ログアウト
  │                  │ (removeAuth)
  ▼                  │
┌──────────┐         │
│認証済み  │ ────────┘
│状態      │
└────────┬─┘
         │
    ブラウザ
    リロード
         │
         ▼
    ┌─────────┐
    │状態確認 │
    │LocalStor│
    └────┬────┘
         │
    ┌────┴────────────────┐
    │                     │
    ▼ YES              NO ▼
 認証済み            未認証状態
  状態                (初期化)
    │
    └─► ホームページ表示
```

### 4.2 資料フロー状態

```
┌──────────────────────┐
│資料アップロード前    │
│(フォーム表示)        │
└────┬─────────────────┘
     │ ユーザー入力
     ▼
┌──────────────────────┐
│バリデーション中      │
│ファイルチェック      │
└────┬─────────────────┘
     │
     ├── FAIL ──> エラー表示 ──┐
     │                        │
     ├── OK                   │
     │                        │
     ▼                        │
┌──────────────────────┐      │
│アップロード待機      │      │
│(確認画面表示)        │      │
└────┬─────────────────┘      │
     │                        │
     ├── キャンセル ────> フォーム初期化
     │                   │
     ├── 確定 ────┐      │
     │            ▼      │
     │      ┌─────────┐  │
     │      │ローカル │  │
     │      │保存     │  │
     │      │成功     │  │
     │      └────┬────┘  │
     │           │       │
     ▼           ▼       ▼
┌──────────────────────────────┐
│資料一覧表示（更新）          │
│新規資料が表示                │
└──────────────────────────────┘
```

## 5. 使用例シナリオ

### 5.1 シナリオ 1：生徒が過去問を検索

```
時間  アクター          操作                  結果
────  ────────────────  ──────────────────  ──────────────────
1:00  生徒              サイト開く          パスワード画面表示
1:05  生徒              パスワード入力       ホームページ表示
1:10  生徒              「資料一覧」クリック 資料一覧ページ表示
1:15  生徒              「数学」選択         数学資料 3 件表示
1:20  生徒              「中間テスト」検索   数学・中間テスト 1 件
1:25  生徒              資料をクリック       詳細ページ表示
1:30  生徒              コメント確認        利用者レビュー表示
1:35  生徒              ダウンロード         ファイル取得
```

### 5.2 シナリオ 2：教師が資料をアップロード

```
時間  アクター          操作                  結果
────  ────────────────  ──────────────────  ──────────────────
1:00  教師              サイト開く          パスワード画面表示
1:05  教師              パスワード入力       ホームページ表示
1:10  教師              「アップロード」     アップロードページ表示
1:15  教師              タイトル入力        「2024 物理期末」
1:20  教師              科目選択            「物理」選択
1:25  教師              説明入力            試験範囲等を入力
1:30  教師              ファイル選択        PDF ファイル選択
1:35  教師              ニックネーム入力    「Mr.Yamada」
1:40  教師              「アップロード」     バリデーション実行
1:45  教師              確認画面確認        内容確認
1:50  教師              「確定」             成功画面表示
2:00  生徒              資料一覧刷新        新規資料表示される
```

---

これらのユースケース図・シーケンス図により、システムの動作フローと各ユーザーアクターの相互作用が明確になります。

